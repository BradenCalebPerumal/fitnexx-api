name: Fitnexx API CI / Testing

# Controls when the workflow should run
on:
  push:
    # Triggers the workflow on pushes to the main branch
    branches: [ main ]
  pull_request:
    # Triggers the workflow on pull requests targeting the main branch
    branches: [ main ]
  # Allows manual run from the GitHub Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs
jobs:
  test_and_install:
    name: Install and Run Tests
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checks out your repository code
    - name: Checkout Code
      uses: actions/checkout@v4
      
    # Step 2: Sets up the Node.js environment (using a recent LTS version)
    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: '20.x' # Using a single, stable LTS version
        cache: 'npm' # Caches npm dependencies for faster builds

    # Step 3: Installs the project dependencies
    - name: Install Dependencies
      # 'npm ci' ensures a clean installation based on package-lock.json
      run: npm ci 
      working-directory: fitnexx-api # FIX: Tells the runner to look in the nested directory for package-lock.json
      
    #Step 4: Runs the unit tests defined in package.json
    - name: Run Jest Unit Tests
      run: npm test
      working-directory: fitnexx-api # FIX: Tells the runner to run 'npm test' from the correct directory